<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>ActivityPub Discovery</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove" defer></script>
  <script class="remove">
    // All config options at https://respec.org/docs/
    var respecConfig = {
      specStatus: "CG-DRAFT",
      latestVersion: null,
      editors: [{ name: "Evan Prodromou", url: "https://socialwebfoundation.org/@evanp" }],
      github: "swicg/activitypub-html-discovery",
      shortName: "apdisco",
      xref: "web-platform",
      group: "socialcg",
      noRecTrack: true
    };
  </script>
</head>

<body>
  <section id="abstract">
    <p>ActivityPub is a standard for publishing structured social network data on the Web in JSON-LD format. This
      document describes various methods for discovering the ActivityPub object described by an HTML page, and
      conversely the HTML page for an ActivityPub object.</p>
  </section>
  <section id="sotd">
    <p>This is a draft of the Social Web Incubator Group (SocialCG) Discovery Task Force.</p>
  </section>
  <section class="informative">
    <h2>Introduction</h2>
    <p>...</p>
    <p>Unless otherwise specified, the techniques described below can be used with any Activity Streams 2.0 types. The best-defined groups of AS2 types for HTML discovery are actor types:</p>
    <ul>
      <li><code>Person</code></li>
      <li><code>Application</code></li>
      <li><code>Service</code></li>
      <li><code>Group</code></li>
      <li><code>Organization</code></li>
    </ul>
    <p>
      and digital content types:
    </p>
    <ul>
      <li><code>Note</code></li>
      <li><code>Article</code></li>
      <li><code>Image</code></li>
      <li><code>Video</code></li>
      <li><code>Audio</code></li>
      <li><code>Document</code></li>
      <li><code>Page</code></li>
    </ul>
    <section>
      <h3>Motivating user stories</h3>
      <p>These are some of the user stories that motivate this work.</p>
      <p>
      <ul>
        <li><em>As a Web user, when viewing a Web page, I want to <code>Like</code> the contents, so that I can share it with my followers, let the author know I appreciated it, and save it to my <code>liked</code> collection.</em> A browser-based ActivityPub API client could submit a <code>Like</code> activity to the user's ActivityPub server, but it would need to know the ID of the ActivityPub equivalent of the page.</li>
        <li><em>As a Web user, when viewing a Web page, I want to <code>Announce</code> the contents, so that I can share it with my followers.</em> A browser-based ActivityPub API client could submit a <code>Announce</code> activity to the user's ActivityPub server, but it would need to know the ID of the ActivityPub equivalent of the page.</li>
        <li><em>As a Web user, when viewing an actor's profile, I want to <code>Follow</code> the actor, so that I can get updates about their activities in my inbox.</em> A browser-based ActivityPub API client could submit a <code>Follow</code> activity to the user's ActivityPub server, but it would need to know the actor ID of the actor whose profile is being viewed.</li>
        <li><em>As a Web user, when viewing an actor's profile, I want to send them a direct message, to share information or make a connection.</em> A browser-based ActivityPub API client could send a <code>Note</code> activity to the user's ActivityPub server, with the profile actor's ID in the <code>to</code> property, but the API client would need to know the actor ID of the actor whose profile is being viewed.</li>
        <li><em>As a Web user, when viewing an image page in my browser, I want to send a direct message to the author, to share information or give feedback.</em> A browser-based ActivityPub API client could send a <code>Note</code> activity to the user's ActivityPub server, with the image's author's actor ID in the <code>to</code> property, but the API client would need to know the actor ID of the author of the image.</li>
        <li><em>As a social network client user, when I see a link in the content of a social media post, I want to load the resource for that link into my social media client without launching an external browser, so that I have a smooth user experience and can fully interact with the content.</em> Given a link like <code>https://html.example/blog/page-1.html</code>, an ActivityPub API client could discover the related ActivityPub ID <code>https://ap.example/api/page-1.jsonld</code>, retrieve it with machine-readable metadata, and provide affordances for interacting with the object, such as liking, sharing, or replying.</li>
        <li><em>As a social network client user, when I see a Webfinger handle mentioned in a social media post, I want to follow a link to the actor's profile page, so I can learn more about them.</em> Converting a Webfinger address into an ActivityPub actor ID is well-covered in the ActivityPub and Webfinger report, but the next step of converting an actor ID to a profile page is not.</li>
        <li><em>As a social network client user, when I see a Webfinger handle mentioned in a social media post, I want to load the actor's profile into my social network client, so I can interact directly with it.</em> If the link in the <code>content</code> is to the actor's profile page, it's necessary to be able to turn that link into an actor ID to allow more inspection of the actor and affordances like following or blocking.</li>
      </ul>
      </p>
    </section>
    <section>
      <h3>Example URL formats</h3>
      <p>This document uses a consistent format for example URLs:
      <pre>
        <code>https://{name}.example/{path}/{type}-{ordinal}{?ext}</code>
      </pre>
      </p>
      <p>Where:</p>
      <ul>
        <li><code>{name}</code> is the domain name of the server. There are three default domain names used:
          <ul>
            <li><code>ap.example</code> - A server that primarily provides ActivityPub JSON-LD documents.</li>
            <li><code>html.example</code> - A server that primarily provides HTML documents.</li>
            <li><code>mixed.example</code> - A server that provides both ActivityPub JSON-LD and HTML documents.</li>
          </ul>
          Other names may be used when additional examples are required.
        </li>
        <li><code>{path}</code> is the path to the object. It should be opaque; none of the paths in this document have
          semantic meaning unless otherwise specified.</li>
        <li><code>{type}</code> is the general content type of object. This will usually be the lowercase version of the
          ActivityPub object type, such as <code>Note</code>, <code>Person</code>, or <code>Image</code>.</li>
        </li>
        <li><code>{ordinal}</code> is an ordinal number, when multiple objects are being described in the same
          discussion.</li>
        <li><code>{ext}</code> is an optional extension that indicates the Internet media type of the resource,
          including:
          <ul>
            <li><code>.jsonld</code> for JSON-LD objects</li>
            <li><code>.html</code> for HTML documents</li>
            <li><code>.png</code>, <code>.jpg</code>, etc. for PNG images</li>
          </ul>
          Extensions may be left off of the URL, especially if the same URL will be used for multiple media types.
        </li>
      </ul>
    </section>
  </section>
  <section>
    <h2 id="discovery">Discovering equivalent ActivityPub objects from HTML</h2>
    <p>This form of discovery, <dfn>forward discovery</dfn>, will identify an ActivityPub JSON-LD resource based on the HTML representation of the object.</p>
    <section>
      <h3>Content negotiation</h3>
      <p><a href="https://en.wikipedia.org/wiki/Content_negotiation">Content negotiation</a> is a catch-all term for
        ways of negotiating the representation of a resource through the HTTP protocol. In this document, it will
        specifically cover <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-3.4.1">proactive negotiation</a>
        using the <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-5.3.2">Accept</a> header.
      </p>
      <p>
        Given the URL for an HTML document, such as <code>https://mixed.example/some/path/to/note-1</code>, a consumer
        could attempt to retrieve the corresponding ActivityPub JSON-LD object using this HTTP request:
      </p>
      <pre class="HTTP">
        GET /some/path/to/note-1 HTTP/1.1
        Host: mixed.example
        Accept: application/activity+json, application/ld+json, application/json
      </pre>
      <p>
        A compliant server may respond with the ActivityPub JSON-LD object in the body of the response:
      </p>
      <pre class="HTTP">
        HTTP/1.1 200 OK
        Content-Type: application/activity+json

        {
          "@context": "https://www.w3.org/ns/activitystreams",
          "id": "https://mixed.example/some/path/to/note-1",
          "type": "Article",
          "content": "This is a note."
        }
      </pre>
      <p>
        This is typically used when the ActivityPub server and the HTML server are implemented in the same software package.
        Because this has historically been the case for many implementations, some consumers expect this behavior to be the
        default.
        </p>
        <p>
        Alternately, the server may respond with a <code>308 Permanent Redirect</code> to indicate the location of the JSON-LD
        representation.
      </p>
      <pre class="HTTP">
        HTTP/1.1 308 Permanent Redirect
        Location: https://mixed.example/different/path/to/note-1.jsonld
      </pre>
      <section>
        <h4>Content negotiation failure</h4>

        <p>
          If the server does not support content negotiation, it may respond with a <code>406 Not Acceptable</code> status
          code.
        </p>
        <pre>
          HTTP/1.1 406 Not Acceptable
          Content-Type: text/plain

          No representation matching this request could be found.
        </pre>
        <p>Less compliant servers may ignore the <code>Accept</code> header altogether and return the HTML content regardless:
        </p>
        <pre class="HTTP">
          HTTP/1.1 200 OK
          Content-Type: text/html

          &lt;html&gt;
          &lt;head&gt;
          &lt;title&gt;Note 1&lt;/title&gt;
          &lt;/head&gt;
          &lt;body&gt;
          &lt;p&gt;This is a note.&lt;/p&gt;
        </pre>
        <p>
          A more difficult failure mode to detect arises when the server does not support ActivityPub, but does support content negotiation for another JSON format. Such a server returns a <code>200 OK</code> status code with a JSON
          object that does not use JSON-LD, or JSON-LD object that does not use the Activity Streams 2.0 vocabulary:
        </p>
        <pre class="HTTP">
          HTTP/1.1 200 OK
          Content-Type: application/json

          {
            "property": "value",
            "otherProperty": "otherValue"
          }
        </pre>
      </section>
    </section>
    <section>
      <h3>HTTP Link header</h3>
      <p>
        The <a href="https://datatracker.ietf.org/doc/html/rfc8288">HTTP Link header</a> can be used to indicate an
        alternative representation of a resource. A consumer can use this header to discover the ActivityPub JSON-LD object
        for an HTML page.
      </p>
      <p>
        Given the URL for an HTML document, such as <code>https://html.example/user/test1/article-1</code>, the consumer can
        use a HTTP <code>HEAD</code> request to get the headers for the resource, which will hopefully include the
        <code>Link</code> header:
      </p>
      <pre class="HTTP">
        HEAD /user/test1/article-1 HTTP/1.1
        Host: html.example
      </pre>
      <p>
        A compliant server will respond with the headers for the resource:
      </p>
      <pre class="HTTP">
      HTTP/1.1 200 OK
      Link: &lt;https://ap.example/api/articles/article-1.jsonld&gt;; rel="alternate"; type="application/activity+json"
      </pre>
      <p>
        The link header with the <code>alternate</code> relation type, and an ActivityPub-compatible media type, indicates
        that the ActivityPub JSON-LD object is available at the linked URL.
      </p>
      <p>
        This can be a very efficient method of discovery, since the consumer does not need to download the entire HTML
        document and parse its contents.
      </p>
      <p>
        Servers may also include the <code>Link</code> header in the response to a <code>GET</code> request for the HTML page.
      </p>
      <pre class="HTTP">
        GET /user/test1/article-1 HTTP/1.1
        Host: html.example
        </pre>
      <p>
        A compliant server will respond with the headers for the resource:
      </p>
      <pre class="HTTP">
      HTTP/1.1 200 OK
      Link: &lt;https://ap.example/api/articles/article-1.jsonld&gt;; rel="alternate"; type="application/activity+json"
      Content-type: text/html

      &lt;html&gt;
      &lt;head&gt;
      ...
      </pre>
      <section>
        <h4>Link header failure</h4>
        <p>
          Some servers may return the full body of the HTML document in response to a <code>HEAD</code> request, without
          including a <code>Link</code> header.
        </p>
        <pre class="HTTP">
        HTTP/1.1 200 OK
        Content-type: text/html

        &lt;html&gt;
        &lt;head&gt;
        ...
        </pre>
      </section>
    </section>
    <section>
      <h3>HTML &lt;link&gt; element</h3>
      <p>The <a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element">link</a> element is a metadata element used in the <code>&lt;head&gt;</code> section of an HTML document. It provides
      links for the whole document, using a number of different link relations.</p>
      <p>To indicate its equivalent ActivityPub object, the HTML page at <code>https://html.example/watch/video-1.html</code> could include the following link element:</p>
      <pre class="HTML">
        &lt;!doctype html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;title&gt;Video 1&lt;/title&gt;
            &lt;link
              rel="alternate"
              type="application/activity+json"
              href="https://ap.example/api/descriptors/video-1.jsonld" /&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;!-- rest of the page --&gt;
          &lt;/body&gt;
        &lt;/html&gt;
      </pre>
      <p>Consumers need to parse the HTML to find the <code>link</code> element with the <code>alternate</code> relation and an ActivityPub-compatible media type as <code>type</code>. This can be slow and complicated.</p>
      <section>
        <h4>Link element failure</h4>
        <p>Some servers may include a <code>link</code> element with an
          <code>alternate</code> relation and with a JSON type or JSON-LD type that does not link to an ActivityPub resource.</p>
        <pre class="HTML">
          &lt;!doctype html&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;title&gt;Video 1&lt;/title&gt;
              &lt;link
                rel="alternate"
                type="application/json"
                href="https://api.example/unrelated/videodescriptor.json" /&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;!-- rest of the page --&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre>
      </section>
    </section>
    <section>
      <h3>HTML &lt;a&gt; element</h3>
      <p>The <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element">a</a> element is an element used in the <code>&lt;body&gt;</code> section of an HTML document. It can be used to define relationships with other documents, with the benefit that the link is (usually) visible and clickable by a reader.</p>
      <p>To indicate its equivalent ActivityPub object, the HTML page at <code>https://html.example/profiles/person-1.html</code> could include the following <code>a</code> element:</p>
      <pre class="HTML">
        &lt;!doctype html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;title&gt;Person 1&lt;/title&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;a
              rel="alternate"
              type="application/activity+json"
              href="https://ap.example/users/person-1.jsonld" &gt;
              Actor data for Person 1
            &lt;/a&gt;
            &lt;!-- rest of the page --&gt;
          &lt;/body&gt;
        &lt;/html&gt;
      </pre>
      <p>Consumers will need to parse the HTML to find the <code>a</code> element with the <code>alternate</code> relation and an ActivityPub-compatible media type as <code>type</code>. This can be even more slow and complicated than with the <code>link</code> header. The <code>link</code> header is usually in the first few kilobytes of a document, and will usually be nested only 2 levels below the document in the DOM tree. An <code>a</code> element may be anywhere in the <code>body</code>, maybe nested very deep in the tree.</p>
      <section>
        <h4>a element failure</h4>
        <p>As with the <code>link</code> element, some servers may include an   <code>a</code> element with an
          <code>alternate</code> relation and with a JSON type or JSON-LD type that does not link to an ActivityPub resource.
        </p>
        <p>
          In addition, many content management systems allow end users to set
          <code>rel</code> and other properties on <code>a</code> elements, which may result in false matches. Even more than with other methods, using the <code>a</code> element for discovery requires reverse discovery for confirmation (see <a href="#best-practices-for-consumers">Best practices for consumers</a>).
        </p>
        </pre>
      </section>
    </section>
    <section>
      <h3>Webfinger</h3>
      <p><a href="https://datatracker.ietf.org/doc/html/rfc7033">Webfinger</a>
      is a standard for discovering metadata about a resource identified with an URL. Finding the ActivityPub URL for an actor identified with an <code>acct:</code> URL is well documented in the <a href="https://www.w3.org/community/reports/socialcg/CG-FINAL-apwf-20240608/">ActivityPub and Webfinger</a> report. However, Webfinger can be used to find metadata about other resources, including HTML pages with <code>https:</code> URLs.</p>
      <p>Given an URL for a document, like <code>https://html.example/group-1.html</code>, a GET request can be made to an URL in the <code>/.well-known/</code> path of the domain for the URL, as follows:</p>
      <pre class="HTTP">
        GET /.well-known/webfinger?resource=https%3A%2F%2Fhtml.example%2Fgroup-1.html HTTP/1.1
        Host: html.example
      </pre>
      <p>A compliant server will respond with the metadata for the resource:</p>
      <pre class="HTTP">
        HTTP/1.1 200 OK
        Content-Type: application/jrd+json

        {
          "subject": "https://html.example/group-1.html",
          "links": [
            {
              "rel": "alternate",
              "type": "application/activity+json",
              "href": "https://ap.example/api/groups/group-1.jsonld"
            }
          ]
        }
      </pre>
      <p>The JRD JSON format includes <a href="https://datatracker.ietf.org/doc/html/rfc7033#section-4.4">a number of properties</a>, as defined in the Webfinger RFC 7033. The relevant data structure in this example is the object in the <code>links</code> array with the <code>rel</code> property set to <code>alternate</code> and the <code>type</code> property set to <code>application/activity+json</code>, an ActivityPub-compatible media type. The <code>href</code> property of this link is URL of the ActivityPub equivalent for the HTML page.</p>
      <section>
        <h4>Webfinger failure</h4>
        <p>Not all Webfinger-aware servers return JRD documents for <code>https</code> URLs. Others might only return JRD documents for URLs that represent actors, such as registered users.</p>
        <p>As with other link-relation-based discovery mechanisms, like the HTTP Link header or the &lt;link&gt; element, a JSON or JSON-LD media in the link's <code>type</code> property might not indicate an ActivityPub URL, but some other JSON or JSON-LD object.</p>
      </section>
    </section>
    <section>
      <h3>Embedded JSON-LD</h3>
      <p>HTML documents can include <a href="https://www.w3.org/TR/json-ld11/">JSON-LD</a> data in a <code>&lt;script&gt;</code> element in the <code>&lt;head&gt;</code> section of the document. This data can be used to provide metadata about the document, including its equivalent ActivityPub object.</p>
      <p>Given a page that shows an image at <code>https://html.example/gallery/image-17.html</code>, the HTML for the page could look like this:</p>
      <pre>
        &lt;!DOCTYPE html&gt;
        &lt;html lang=&quot;en&quot;&gt;
          &lt;head&gt;
            &lt;title&gt;Image 17&lt;/title&gt;
            &lt;script type=&quot;application/ld+json&quot;&gt;
            {
              &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
              &quot;type&quot;: &quot;Image&quot;,
              &quot;id&quot;: &quot;https://ap.example/api/images/image-17.jsonld&quot;,
              &quot;url&quot;: [
                {
                  &quot;type&quot;: &quot;Link&quot;,
                  &quot;mediaType&quot;: &quot;text/html&quot;,
                  &quot;href&quot;: &quot;https://html.example/gallery/image-17.html&quot;
                }
              ]
            }
            &lt;/script&gt;
          &lt;/head&gt;
          &lt;body&gt;
              &lt;h1&gt;Image 17&lt;/h1&gt;
              &lt;p&gt;&lt;img src=&quot;https://html.example/images/image-17.png&quot;&gt;&lt;/p&gt;
          &lt;/body&gt;
        &lt;/html&gt;
      </pre>
      <p>This embedded JSON-LD specifies that an ActivityPub object with the ID <code>https://ap.example/api/images/image-17.jsonld</code> exists, and that it has an HTML page <code>url</code> at <code>https://html.example/gallery/image-17.html</code>, that is, the current page's URL. This is a roundabout, but clear, way to specify the ActivityPub ID of the current page.</p>
      <p>Consumers need to parse the HTML page, and the embedded JSON-LD, to extract the ActivityPub object ID. An advantage to this technique is that other properties of the ActivityPub object can be embedded as well; however, to confirm those properties, the consumer will need to fetch the object from its canonical URL, the ID, anyways.</p>
      <section>
        <h4>Embedded JSON-LD failure</h4>
        <p>
          Complicated structures for the <code>url</code> property may make it hard to confirm that the object's URL is the same as the current page's.
        </p>
        <p>
          Embedded JSON-LD is very popular for embedding <a href="https://schema.org/">Schema.org</a> metadata. This can lead to false positives when looking for ActivityPub objects.
        </p>
      </section>
    </section>
  </section>
  <section>
    <h2 id="reverse-discovery">Discovering HTML pages from ActivityPub objects</h2>
    <p>
        <dfn>Reverse discovery</dfn>, in this report, means identifying the HTML
        page that represents the same object as an ActivityPub JSON-LD object. This is necessary for user stories like creating a link to an actor in microsyntax.
    </p>
    <section>
      <h3><code>url</code> property</h3>
      <p>ActivityPub objects can have an optional <code>url</code> property, which "[i]dentifies one or more links to representations of the object." The property is the preferred way to indicate a corresponding HTML page for an ActivityPub object.
      </p>
      <p>As with many Activity Vocabulary properties, this can have several formats:
      </p>
      <ul>
        <li>A string. In this case, the string is the URL itself.</li>
        <li>A <code>Link</code> object. This structure is used to provide additional information about the link, including the <code>mediaType</code>. For an equivalent HTML representation, the <code>mediaType</code> property will be "text/html". The <code>href</code> property of the <code>Link</code> object is the URL.</li>
        <li>An array: One or more strings and/or <code>Link</code> objects.</li>
      </ul>
      <p>In this example, the <code>url</code> property is only a string.</p>
      <pre class="HTTP">
      {
        "@context": "https://www.w3.org/ns/activitystreams",
        "id": "https://ap.example/some/path/person-1.jsonld",
        "type": "Person",
        "name": "Person One",
        "url": "https://html.example/profile/person-1.html"
      }
      </pre>
      <p>In the next example, the <code>url</code> property is a full <code>Link</code>-type object with <code>mediaType</code> property
      equal to "text/html".</p>
      <pre class="HTTP">
      {
        "@context": "https://www.w3.org/ns/activitystreams",
        "id": "https://ap.example/geo/place-17.jsonld",
        "type": "Place",
        "nameMap": {
          "en": "Berlin"
        },
        "url": {
          "type": "Link",
          "mediaType": "text/html",
          "href": "https://html.example/map/de/ber/ber.html"
        }
      }
      </pre>
      <p>
        In this final example, the <code>url</code> property is an array of <code>Link</code>-type objects with different <code>mediaType</code> properties.
      </p>
      <pre class="HTTP">
      {
        "@context": "https://www.w3.org/ns/activitystreams",
        "id": "https://ap.example/photos/gallery/image-3.jsonld",
        "type": "Image",
        "summary": "Jason and Carol at the lake house",
        "url": [
          {
            "type": "Link",
            "mediaType": "text/html",
            "href": "https://html.example/gallery/3.html"
          },
          {
            "type": "Link",
            "mediaType": "image/webp",
            "href": "https://upload.example/files/08/17/2021/lakehouse.webp"
          }
        ]
      }
    </pre>
      <section>
        <h4><code>url</code> property failure</h4>
        <p>
          When the <code>url</code> property is only a string, it may not
          represent an HTML page. Especially for objects with binary content types, like <code>Image</code>, <code>Video</code>, and <code>Audio</code>, the <code>url</code> property is often used for the URL of the respective binary representation of the object.
        </p>
        <p>
          The <code>mediaType</code> of <code>Link</code>-type objects in the <code>url</code> property is not always defined, and when it is defined, it is not always "text/html".
        </p>
        <p>
          The property is defined only for representations of the current object. However, the <code>Link</code>-type object can have a link relation property, <code>rel</code>. Publishers may misuse the <code>url</code> property to including links that aren't a representation of the object, but instead a related object, like "next" or "author".
        </p>
      </section>
    </section>
    <section>
      <h3>Content negotiation</h3>
      <p>As with forward discovery, it's possible for the HTML and JSON-LD representations of an object to be found at the same URL.</p>
      <p>
        Given the URL for an ActivityPub object, such as <code>https://mixed.example/some/path/to/note-1</code>, a consumer
        could attempt to retrieve the corresponding HTML resource using this HTTP request:
      </p>
      <pre class="HTTP">
        GET /some/path/to/note-1 HTTP/1.1
        Host: mixed.example
        Accept: text/html
      </pre>
      <p>
        A compliant server may respond with the HTML document in the body of the response:
      </p>
      <pre class="HTTP">
        HTTP/1.1 200 OK
        Content-Type: text/html

        &lt;html&gt;
        &lt;head&gt;
        &lt;title&gt;Note 1&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
        &lt;p&gt;This is a note.&lt;/p&gt;
      </pre>
      <p>
        Alternately, the server may respond with a <code>308 Permanent Redirect</code> to indicate the location of the HTML
        representation.
      </p>
      <pre class="HTTP">
        HTTP/1.1 308 Permanent Redirect
        Location: https://mixed.example/different/path/to/note-1.html
      </pre>
      <section>
        <h4>Content negotiation failure</h4>

        <p>
          If the server does not support content negotiation, it may respond with a <code>406 Not Acceptable</code> status
          code.
        </p>
        <pre>
          HTTP/1.1 406 Not Acceptable
          Content-Type: text/plain

          No representation matching this request could be found.
        </pre>
        <p>Less compliant servers may ignore the <code>Accept</code> header altogether and return the JSON-LD content regardless:
        </p>
        <pre class="HTTP">
          HTTP/1.1 200 OK
          Content-Type: application/activity+json

          {
            "@context": "https://www.w3.org/ns/activitystreams",
            "id": "https://mixed.example/some/path/to/note-1",
            "type": "Note",
            "content": "This is a note."
          }
        </pre>
        <p>
      </section>
    </section>
    <section>
      <h3>HTTP Link header</h3>
      <p>As with forward discovery, it is possible to use the <code>Link</code> header to identify an HTML page related to a given ActivityPub JSON-LD resource. A <code>Link</code> header with the <code>alternate</code> link relation and a <code>type</code> equal to <code>text/html</code> indicates an HTML page representing the same object.</p>
      <p>The advantage of this technique is that it does not require downloading and parsing the JSON-LD content of the ActivityPub object. The <code>Link</code> header has fewer options for formatting than other methods such as the <code>url</code> property, for example, making it slightly easier for consumers.</p>
      <section>
      <h4>Example</h4>
      <p>Given an ActivityPub JSON-LD object at <code>https://ap.example/some/path/person-1.jsonld</code>, a consumer could use a <code>HEAD</code> HTTP request to get the relevant headers for the resource:</p>
      <pre class="HTTP">
        HEAD /some/path/person-1.jsonld HTTP/1.1
        Host: ap.example
      </pre>
      <p>The publisher would respond with the HTTP headers, including a <code>Link</code> header:</p>
      <pre class="HTTP">
        HTTP/1.1 200 OK
        Content-Type: application/activity+json
        Link: &lt;https://html.example/profiles/person-1.html&gt;; rel="alternate"; type="text/html"
      </pre>
      </section>
      <section>
        <h4>HTTP Link header failure</h4>
        <p>Some non-compliant HTTP servers will send the full body of the resource in the response to the <code>HEAD</code> request.</p>
      </section>
    </section>
    <section>
      <h3>Webfinger</h3>
      <p>The Webfinger protocol can be used to find an HTML page related to an ActivityPub object in a number of ways.</p>
      <p>The consumer can identify the resource for the a Webfinger query in two ways. First, the <code>id</code> property, usually an <code>https</code> URL, can be passed as the <code>resource</code> parameter for the Webfinger query. Alternately, if the ActivityPub object is an <a href="https://www.w3.org/TR/activitypub/#actors">actor</a>, an <code>acct</code> URL in the format <code>acct:username@domain.example</code> can be constructed using the technique for <a href="https://www.w3.org/community/reports/socialcg/CG-FINAL-apwf-20240608/#reverse-discovery">Webfinger reverse discovery</a>. This <code>acct</code> URL can be used as the <code>resource</code> parameter for the Webfinger query.</p>
      <p>The publisher can provide a link to the HTML representation of the object in the JRD output of the Webfinger query in at least two ways.
      </p>
      <p>
       First, the <code>links</code> property of the output object can contain a link object with a <code>rel</code> property set to <code>alternate</code> and the <code>type</code> property set to <code>text/html</code>. If such a link exists, its <code>href</code> property is the URL of the related HTML page.
      </p>
      <p>Second, the <code>links</code> property of the JRD output object may include an object with a <code>rel</code> property set to <code>http://webfinger.net/rel/profile-page</code>. This is defined to be "the main home/profile page that a human should visit when getting info about that webfinger account." (<a href="https://webfinger.net/rel/">https://webfinger.net/rel/</a>) It is not guaranteed to be HTML, but a <code>type</code> property can further define that. Per the definition, "it&apos;s likely text/html if it&apos;s for users."</p>
      <p>An advantage of using Webfinger for discovery is that it is widely implemented by ActivityPub publishers to enable using <code>acct</code> URLs as identities.</p>
      <section>
        <h4>Examples</h4>
        <p>
          Given an ActivityPub <code>Place</code> object at <code>https://ap.example/geo/place-7.jsonld</code>, a consumer could use a Webfinger query to find the HTML page for the object:
        </p>
        <pre class="HTTP">
          GET /.well-known/webfinger?resource=https%3A%2F%2Fap.example%2Fgeo%2Fplace-7.jsonld HTTP/1.1
          Host: ap.example
        </pre>
        <p>The publisher could return the following JRD output:</p>
        <pre class="JSON">
          {
            "subject": "https://ap.example/geo/place-7.jsonld",
            "links": [
              {
                "rel": "alternate",
                "type": "text/html",
                "href": "https://html.example/map/nl/ams/17921.html"
              }
            ]
          }
        </pre>
        <p>
          In this example, the <code>links</code> property of the JRD object contains a single object with a <code>rel</code> property set to <code>alternate</code> and a <code>type</code> property set to <code>text/html</code>. The <code>href</code> property of this object is the URL of the HTML page representing the object.
        </p>
        <p>
          Alternately, given an ActivityPub <code>Person</code> object at <code>https://ap.example/profiles/person-19.jsonld</code>, the consumer could construct an <code>acct</code> URL as <code>acct:person-19@ap.example</code> and use it as the <code>resource</code> parameter for the Webfinger query:
        </p>
        <pre class="HTTP">
          GET /.well-known/webfinger?resource=acct%3Aperson-19%40ap.example HTTP/1.1
          Host: ap.example
        </pre>
        <p>The publisher could return the following JRD output:</p>
        <pre class="JSON">
          {
            "subject": "acct:person-19@ap.example",
            "links": [
              {
                "rel": "http://webfinger.net/rel/profile-page",
                "type": "text/html",
                "href": "https://html.example/profiles/person-19.html"
              }
            ]
          }
        </pre>
        <p>In this output, the <code>http://webfinger.net/rel/profile-page</code> relationship identifies an HTML page for the <code>Person</code> object.</p>
      </section>
      <section>
        <h4>Webfinger failure</h4>
        <p>Some servers may not return JRD documents for <code>https</code> URLs. Others might only return JRD documents for URLs that represent actors, such as registered users.</p>
      </section>
    </section>
  </section>
  <section>
    <h2 id="author-discovery">Discovering ActivityPub authors from HTML</h2>
    <p>This section describes various methods for determining the ActivityPub ID of the author of an object represented by an HTML page.</p>
    <section>
      <h3>Discover equivalent object</h3>
      <p>One way to discover the author of an object represented by an HTML page is to first discover the object's ActivityPub JSON-LD representation, then use that information to determine the author.</p>
      <p>Any of the methods in the <a href="#discovery">forward discovery</a> section can be used to find the URL of the ActivityPub JSON-LD resource. Fetching the resource will retrieve the full JSON-LD representation of the object.</p>
      <p>Three main properties are used, in ActivityPub, to identify the author of an object:</p>
      <ul>
        <li><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-attributedto">attributedTo</a>. This is the primary property for defining the author of an object. It is primarily used for content-type objects, such as <code>Note</code>, <code>Image</code> or <code>Video</code>, but can also be used for other object types.</li>
        <li><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-actor">actor</a>. This identifies the actor who performed activity-type objects, such as a <code>Like</code> or <code>Question</code> activity.</li>
        <li><a href="https://w3c-ccg.github.io/security-vocab/#owner">owner</a>. This property is almost exclusively used for <a href="https://w3c-ccg.github.io/security-vocab/#publicKey">publicKey</a> objects.</li>
      </ul>
      <p>Each of these properties can have values that are a string, a JSON object, or a JSON array consisting of strings and/or JSON objects. If the value is a string, it is the URL of the author object. If the value is an object, its <code>id</code> property is the URL of the ActivityPub JSON-LD object. For an array, each item can be resolved as either a string or an object.</p>
      <p>The advantage of this method is that it does not require a separate discovery path for authors.</p>
      <section>
        <h3>Example</h3>
        <p>Given an HTML page at <code>https://html.example/note-1.html</code> that represents a <code>Note</code> object, the consumer can use an HTML &lt;link&gt; header to identify the URL of the ActivityPub note:</p>
        <pre class="HTML">
          &lt;link
            rel="alternate"
            type="application/activity+json"
            href="https://ap.example/api/notes/note-1.jsonld" /&gt;
        </pre>
        <p>Fetching the content at <code>https://ap.example/api/notes/note-1.jsonld</code> will return the JSON-LD representation of the note:</p>
        <pre class="JSON">
          {
            "@context": "https://www.w3.org/ns/activitystreams",
            "id": "https://ap.example/api/notes/note-1.jsonld",
            "type": "Note",
            "content": "This is a note.",
            "attributedTo": {
              "id": "https://ap.example/profiles/person-1.jsonld",
              "type": "Person",
              "name": "Person One"
            }
          }
        </pre>
        <p>
          In this example, the <code>attributedTo</code> property is an object with an <code>id</code> property that is the URL of the author object.
        </p>
      </section>
      <section>
        <h3>Object discovery failure</h3>
        <p>This discovery method can fail if the ActivityPub object requires authentication to be fetched -- which is often the case for content that was not made available to the public by the author. A simple consumer may not have the context necessary to use OAuth 2.0, HTTP Signature, or other authentication methods.</p>
        <p>Not all ActivityPub implementations include the <code>attributedTo</code> or <code>actor</code> property for an object in its default representation.</p>
      </section>
    </section>
    <section>
      <h3>HTTP Link header</h3>
      <p>The <code>Link</code> header can also be used to identify the author of an HTML page. The <a href="https://html.spec.whatwg.org/multipage/links.html#link-type-author">author</a> link type identifies the author of a resource. So, a <code>Link</code> header with a <code>rel</code> property equal to "author" and a <code>type</code> property equal to "application/activity+json" will link to the ActivityPub representation of the author of the object.</p>
      <p>This technique has the advantage of requiring a minimum amount of data transfer and complicated parsing of data structures.</p>
      <section>
        <h4>Example</h4>
        <p>
          Given an HTML page at <code>https://html.example/files/video-33.html</code> that represents a <code>Video</code> object, the consumer can use an HTTP <code>HEAD</code> request to identify the URL of the ActivityPub video:
        </p>
        <pre class="HTTP">
          HEAD /files/video-33.html HTTP/1.1
          Host: html.example
        </pre>
        <p>The publisher would respond with the HTTP headers:</p>
        <pre class="HTTP">
          HTTP/1.1 200 OK
          Content-Type: text/html
          Link: &lt;https://ap.example/api/videos/video-33.jsonld&gt;; rel="alternate"; type="application/activity+json"
          Link: &lt;https://ap.example/profiles/person-7.jsonld&gt;; rel="author"; type="application/activity+json"
        </pre>
        <p>Note that there are two <code>Link</code> headers in the result; one represents the <code>Video</code>, and the other represents the <code>Person</code> that authored the video. The <code>rel</code> value of "author" distinguishes the author link.</p>
      </section>
      <section>
        <h4>Link header failure</h4>
        <p>Some non-compliant publishers will respond to a <code>HEAD</code> request with the full body of the HTML document.</p>
      </section>
    </section>
    <section>
      <h3>HTML &lt;link&gt; element</h3>
    </section>
    <section>
      <h3>Embedded JSON-LD</h3>
    </section>
    <section>
      <h3>OpenGraph</h3>
    </section>
  </section>
  <section>
    <h2>Best practices for consumers</h2>
    <section>
      <h3>Two-way confirmation</h3>
    </section>
    <section>
      <h3>Order of discovery techniques</h3>
      <section>
        <h4>Discovering ActivityPub objects</h4>
      </section>
      <section>
        <h4>Discovering authors</h4>
      </section>
      <section>
        <h4>Discovering HTML pages</h4>
      </section>
    </section>
    <section>
      <h3>Handling multiple results</h3>
    </section>
  </section>
  <section>
    <h2>Best practices for publishers</h2>
    <section>
      <h3>Two-way confirmation</h3>
    </section>
    <section>
      <h3>Discovery techniques to support</h3>
    </section>
    <section>
      <h3>Multiple results</h3>
    </section>
  </section>
  <section id="conformance">
    <p>
      This is required for specifications that contain normative material.
    </p>
  </section>
</body>

</html>

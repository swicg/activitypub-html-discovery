<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>ActivityPub Discovery</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove" defer></script>
  <script class="remove">
    // All config options at https://respec.org/docs/
    var respecConfig = {
      specStatus: "CG-DRAFT",
      editors: [{ name: "Evan Prodromou", url: "acct:evanp@socialwebfoundation.org" }],
      github: "swicg/activitypub-html-discovery",
      shortName: "apdisco",
      xref: "web-platform",
      group: "socialcg",
      noRecTrack: true
    };
  </script>
</head>

<body>
  <section id="abstract">
    <p>ActivityPub is a standard for publishing structured social network data on the Web in JSON-LD format. This
      document describes various methods for discovering the ActivityPub object described by an HTML page, and
      conversely the HTML page for an ActivityPub object.</p>
  </section>
  <section id="sotd">
    <p>This is a draft of the Social Web Incubator Group (SocialCG) Discovery Task Force.</p>
  </section>
  <section class="informative">
    <h2>Introduction</h2>
    <p>...</p>
    <section>
      <h3>Motivating user stories</h3>
      <p>
      <ul>
        <li>...</li>
      </ul>
      </p>
    </section>
    <section>
      <h3>Example URL formats</h3>
      <p>This document uses a consistent format for example URLs:
      <pre>
          <code>https://{name}.example/{path}/{type}-{ordinal}{?ext}</code>
        </pre>
      </p>
      <p>Where:
      <ul>
        <li><code>{name}</code> is the domain name of the server. There are three default domain names used:
          <ul>
            <li><code>ap.example</code> - A server that primarily provides ActivityPub JSON-LD documents.</li>
            <li><code>html.example</code> - A server that primarily provides HTML documents.</li>
            <li><code>mixed.example</code> - A server that provides both ActivityPub JSON-LD and HTML documents.</li>
          </ul>
          Other names may be used when additional examples are required.
        </li>
        <li><code>{path}</code> is the path to the object. It should be opaque; none of the paths in this document have
          semantic meaning unless otherwise specified.</li>
        <li><code>{type}</code> is the general content type of object. This will usually be the lowercase version of the
          ActivityPub object type, such as <code>Note</code>, <code>Person</code>, or <code>Image</code>.</li>
        </li>
        <li><code>{ordinal}</code> is an ordinal number, when multiple objects are being described in the same
          discussion.</li>
        <li><code>{ext}</code> is an optional extension that indicates the Internet media type of the resource,
          including:
          <ul>
            <li><code>.jsonld</code> for JSON-LD objects</li>
            <li><code>.html</code> for HTML documents</li>
            <li><code>.png</code>, <code>.jpg</code>, etc. for PNG images</li>
          </ul>
          Extensions may be left off of the URL, especially if the same URL will be used for multiple media types.
        </li>
      </ul>
      </p>
    </section>
  </section>
  <section>
    <h2>Discovering equivalent ActivityPub objects from HTML</h2>
    <section>
      <h3>Content negotiation</h3>
      <p><a href="https://en.wikipedia.org/wiki/Content_negotiation">Content negotiation</a> is a catch-all term for
        ways of negotiating the representation of a resource through the HTTP protocol. In this document, it will
        specifically cover <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-3.4.1">proactive negotiation</a>
        using the <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-5.3.2">Accept</a> header.
      </p>
      <p>
        Given the URL for an HTML document, such as <code>https://mixed.example/some/path/to/note-1</code>, a consumer
        could attempt to retrieve the corresponding ActivityPub JSON-LD object using this HTTP request:
      </p>
      <pre class="HTTP">
                    GET /some/path/to/note-1 HTTP/1.1
                    Host: mixed.example
                    Accept: application/activity+json; application/ld+json; application/json
                  </pre>
      <p>
        A compliant server may respond with the ActivityPub JSON-LD object in the body of the response:
      </p>
      <pre class="HTTP">
              HTTP/1.1 200 OK
              Content-Type: application/activity+json

              {
                "@context": "https://www.w3.org/ns/activitystreams",
                "id": "https://mixed.example/some/path/to/note-1",
                "type": "Article",
                "content": "This is a note."
              }
            </pre>
      <p>
        Alternately, the server may respond with a <code>308 Permanent Redirect</code> to indicate the location of the JSON-LD
        representation.
      </p>
      <pre class="HTTP">
                    HTTP/1.1 308 Permanent Redirect
                    Location: https://mixed.example/different/path/to/note-1.jsonld
                  </pre>
      <section>
        <h4>Content negotiation failure</h4>

        <p>
          If the server does not support content negotiation, it may respond with a <code>406 Not Acceptable</code> status
          code.
        </p>
        <pre>
              HTTP/1.1 406 Not Acceptable
              Content-Type: text/plain

              No representation matching this request could be found.
            </pre>
        <p>Less compliant servers may ignore the <code>Accept</code> header altogether and return the HTML content regardless:
        </p>
        <pre class="HTTP">
              HTTP/1.1 200 OK
              Content-Type: text/html

              &lt;html&gt;
              &lt;h ead&gt;
              &lt;title&gt;Article 1&lt;/title&gt;
              &lt;/head&gt;
              &lt;body&gt;
              &lt;p&gt;This is a note.&lt;/p&gt;
            </pre>
        <p>
          A more difficult failure mode to detect arises when the server does not support ActivityPub, but does support content negotiation for another JSON format. Such a server returns a <code>200 OK</code> status code with a JSON
          object that does not use JSON-LD, or JSON-LD object that does not use the Activity Streams 2.0 vocabulary:
        </p>
        <pre class="HTTP">
              HTTP/1.1 200 OK
              Content-Type: application/json

              {
                "property": "value",
                "otherProperty": "otherValue"
              }
            </pre>
      </section>
    </section>
    <section>
      <h3>HTTP Link header</h3>
    </section>
    <section>
      <h3>HTML &gt;link&lt; element</h3>
    </section>
    <section>
      <h3>Embedded JSON-LD</h3>
    </section>
    <section>
      <h3>OpenGraph</h3>
    </section>
    <section>
      <h3>Webfinger</h3>
    </section>
    <section>
      <h3>LRDD</h3>
    </section>
  </section>
  <section>
    <h2>Discovering ActivityPub authors from HTML</h2>
    <section>
      <h3>Discover equivalent object</h3>
    </section>
    <section>
      <h3>HTTP Link header</h3>
    </section>
    <section>
      <h3>HTML &gt;link&lt; element</h3>
    </section>
    <section>
      <h3>Embedded JSON-LD</h3>
    </section>
    <section>
      <h3>OpenGraph</h3>
    </section>
  </section>
  <section>
    <h2>Discovering HTML pages from ActivityPub objects</h2>
    <section>
      <h3><code>url</code> property</h3>
    </section>
    <section>
      <h3>Content negotiation</h3>
    </section>
    <section>
      <h3>HTTP Link header</h3>
    </section>
    <section>
      <h3>Webfinger</h3>
    </section>
  </section>
  <section>
    <h2>Best practices for consumers</h2>
    <section>
      <h3>Two-way confirmation</h3>
    </section>
    <section>
      <h3>Order of discovery techniques</h3>
      <section>
        <h4>Discovering ActivityPub objects</h4>
      </section>
      <section>
        <h4>Discovering authors</h4>
      </section>
      <section>
        <h4>Discovering HTML pages</h4>
      </section>
    </section>
    <section>
      <h3>Handling multiple results</h3>
    </section>
  </section>
  <section>
    <h2>Best practices for publishers</h2>
    <section>
      <h3>Two-way confirmation</h3>
    </section>
    <section>
      <h3>Discovery techniques to support</h3>
    </section>
    <section>
      <h3>Multiple results</h3>
    </section>
  </section>
  <section id="conformance">
    <p>
      This is required for specifications that contain normative material.
    </p>
  </section>
</body>

</html>